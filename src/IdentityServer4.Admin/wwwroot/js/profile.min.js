$(function(){function n(n){const t="/api/user/"+app.getPathPart(window.location.href,1)+"/profile";app.get(t,function(t){n.$data.el={};n.$data.el.userName=t.data.userName;n.$data.el.email=t.data.email;n.$data.el.phoneNumber=t.data.phoneNumber;n.$data.el.lastName=t.data.lastName;n.$data.el.firstName=t.data.firstName;n.$data.el.officePhone=t.data.officePhone;n.$data.el.sex=t.data.sex;n.$data.el.group=t.data.group;n.$data.el.title=t.data.title;n.$data.el.level=t.data.level;n.$data.el.roles=t.data.roles})}new Vue({el:"#view",data:{activeMenu:"个人信息",menus:menus,module:"个人信息",moduleDescription:"",breadcrumb:[{name:"个人信息",href:"#"}],el:{userName:"",email:"",phoneNumber:"",lastName:"",firstName:"",officePhone:"",roles:"",sex:"Male",title:"",group:"",level:""},changePasswordDto:{oldPassword:"",newPassword:"",repeatPassword:""},errors:[]},created:function(){n(this)},watch:{el:function(n){$("#sex").val(n.sex).trigger("change");$("#title").val(n.title).trigger("change");$("#group").val(n.group).trigger("change");$("#level").val(n.level).trigger("change")}},mounted:function(){let n=this;$(".select2").select2({minimumResultsForSearch:Infinity});$("#sex").on("change",function(){n.el.sex=$("#sex").val()});$("#title").on("change",function(){n.el.title=$("#title").val()});$("#group").on("change",function(){n.el.group=$("#group").val()});$("#level").on("change",function(){n.el.level=$("#level").val()})},methods:{checkProfile:function(){return this.errors=[],app.requireCheck(this.el.userName)?app.rangeCheck(this.el.userName.length,4,30)||this.errors.push("用户名长度范围为 4-30"):this.errors.push("用户名不能为空"),app.emailCheck(this.el.email)||this.errors.push("邮箱地址不正确"),app.mobileCheck(this.el.phoneNumber)||this.errors.push("手机号码不正确"),app.phoneCheck(this.el.officePhone)||this.errors.push("公司电话不正确"),app.requireCheck(this.el.firstName)?app.rangeCheck(this.el.firstName.length,1,50)||this.errors.push("姓 长度范围为 1-50"):this.errors.push("姓 不能为空"),app.requireCheck(this.el.lastName)?app.rangeCheck(this.el.lastName.length,1,50)||this.errors.push("名 长度范围为 1-50"):this.errors.push("名 不能为空"),!this.errors.length},checkPassword:function(){return this.errors=[],app.requireCheck(this.changePasswordDto.oldPassword)||this.errors.push("旧密码不能为空"),app.requireCheck(this.changePasswordDto.newPassword)||this.errors.push("新密码不能为空"),app.rangeCheck(this.changePasswordDto.newPassword.length,6,24)||this.errors.push("密码长度范围为 6-24"),app.equalCheck(this.changePasswordDto.newPassword,this.changePasswordDto.repeatPassword)||this.errors.push("两次密码不一致"),!this.errors.length},update:function(){this.checkProfile()&&app.put("/api/user/"+app.getPathPart(window.location.href,1)+"/profile",this.$data.el,function(){swal({title:"更新成功",type:"success",showCancelButton:!1})},function(n){swal({title:"更新失败",type:"error",text:n.msg,showCancelButton:!1})})},changePassword:function(){this.checkPassword()&&app.put("/api/user/"+app.getPathPart(window.location.href,1)+"/password",this.$data.changePasswordDto,function(){swal({title:"更新成功",type:"success",showCancelButton:!1})},function(n){swal({title:"更新失败",type:"error",text:n.msg,showCancelButton:!1})})}}})});